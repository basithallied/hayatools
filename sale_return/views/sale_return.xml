<odoo>
  <data>
    <record id="sale_return_view_form" model="ir.ui.view">
      <field name="name">sale.return.view.form</field>
      <field name="model">sale.return</field>
      <field name="arch" type="xml">
        <form string="Sale Return" create="0">
          <header>
            <button string="Request Approval" name="request_approval" invisible="state != 'draft'" type="object" class="oe_highlight"/>
            <button string="Approve" name="approve" invisible="state != 'waiting'" type="object" class="oe_highlight"/>
            <button string="Reject" name="reject" invisible="state != 'waiting'" type="object" class="oe_highlight"/>
            <button string="Confirm" name="confirm" invisible="state != 'approved'" type="object" class="oe_highlight"/>
            <button string="Credit Note" name="create_credit_note" type="object" class="oe_highlight"
                    invisible="state != 'done' or show_credit_note_button == False"/>
            <button string="Cancel" name="cancel" invisible="state != 'done'" type="object"/>
            <field name="state" widget="statusbar" statusbar_visible="draft,done"/>
          </header>
          <sheet>
            <div class="oe_button_box" name="button_box">
              <button name="view_pickings" type="object" class="oe_stat_button" icon="fa-truck"
                      invisible="picking_count &gt; 1">
                <field name="picking_count" string="Return Receipt" widget="statinfo"/>
              </button>
              <button name="view_credit_notes" type="object" class="oe_stat_button" icon="fa-money"
                      invisible="credit_note_count &lt; 1">
                <field name="credit_note_count" string="Credit Notes" widget="statinfo"/>
              </button>
            </div>
            <div name="title" class="oe_title">
              <h1>
                <field name="display_name" readonly="1" nolabel="1"/>
              </h1>
            </div>
            <group>
              <group>
                <field name="partner_id" required="1" readonly="1"/>
                <field name="sale_order_id" readonly="0"/>
              </group>
              <group>
                <field name="date" readonly="state not in ['draft']"/>
                <field name="confirmation_force_date" readonly="state not in ['draft']"/>
                <field name="show_credit_note_button" invisible="1"/>
              </group>
            </group>
            <notebook>
              <page name="return_lines" string="Products">
                <field name="return_line_ids" widget="section_and_note_one2many" readonly="state not in ['draft']">
                  <list editable="top" create="0">
                    <field name="product_id" force_save="1" readonly="1"/>
                    <field name="tracking" force_save="1" column_invisible="1"/>
                    <field name="name"/>
                    <field name="quantity"/>
                    <field name="uom_id" force_save="1" readonly="1"/>
                    <field name="available_lot_ids" widget="many2many_tags" column_invisible="1"/>
                    <field name="lot_ids" string="Lot/Serial No" widget="many2many_tags" domain="[('id', 'in', available_lot_ids)]" column_invisible="1" options="{'no_create': True, 'no_create_edit':True}"/>
                    <field name="received_qty" column_invisible="1"/>
                    <field name="credit_note_qty" column_invisible="1"/>
                    <field name="sale_order_line_id" column_invisible="1"/>
                  </list>
                  <form>
                    <sheet>
                      <group>
                        <field name="product_id" force_save="1" readonly="1"/>
                        <field name="name"/>
                        <field name="quantity"/>
                        <field name="uom_id" force_save="1" readonly="1"/>
                        <field name="tracking" force_save="1" invisible="1"/>
                        <field name="available_lot_ids" widget="many2many_tags" invisible="1"/>
                        <field name="lot_ids" string="Lot/Serial No" widget="many2many_tags" domain="[('id', 'in', available_lot_ids)]" readonly="tracking == 'none'" options="{'no_create': True, 'no_create_edit':True}"/>
                      </group>
                    </sheet>
                  </form>
                </field>
              </page>
              <page name="other_info" string="Other Info">
                <group name="other_info">
                  <group name="sales_info">
                    <field name="user_id" widget="many2one_avatar_user" readonly="state not in ['draft']"/>
                    <field name="company_id" readonly="1"/>
                  </group>
                </group>
              </page>
            </notebook>
          </sheet>
          <chatter/>
        </form>
      </field>
    </record>

    <record id="sale_return_view_list" model="ir.ui.view">
      <field name="name">sale.return.view.list</field>
      <field name="model">sale.return</field>
      <field name="arch" type="xml">
        <list string="Sale Returns" create="1">
          <field name="display_name" />
          <field name="partner_id" />
          <field name="sale_order_id" />
          <field name="date" />
          <field name="user_id" widget="many2one_avatar_user"/>
          <field name="state" />
        </list>
      </field>
    </record>

    <record id="sale_return_view_search" model="ir.ui.view">
      <field name="name">sale.return.view.search</field>
      <field name="model">sale.return</field>
      <field name="arch" type="xml">
        <search>
          <field name="display_name" />
          <field name="sale_order_id" />
          <field name="partner_id" />
          <filter string="My Sale Returns" domain="[('user_id', '=', uid)]" name="my_sale_returns_filter"/>
          <separator/>
          <filter name="draft_state" string="Draft" domain="[('state', '=', 'draft')]" />
          <filter name="waiting_approval_state" string="Waiting Approval" domain="[('state', '=', 'waiting')]" />
          <filter name="approved_state" string="Approved" domain="[('state', '=', 'approved')]" />
          <filter name="done_state" string="Done" domain="[('state', '=', 'done')]" />
          <filter name="cancelled_state" string="Cancelled" domain="[('state', '=', 'cancel')]" />
          <separator/>
          <filter name="customer_group" string="Customer" context="{'group_by': 'partner_id'}" />
          <filter name="sale_order_group" string="Sale Order" context="{'group_by': 'sale_order_id'}" />
          <filter name="salesperson_group" string="Salesperson" context="{'group_by': 'user_id'}" />
          <filter name="state_group" string="Status" context="{'group_by': 'state'}"/>
          <separator/>
          <filter name="date" string="Date" context="{'group_by': 'date'}"/>
        </search>
      </field>
    </record>

    <record id="sale_return_action" model="ir.actions.act_window">
      <field name="name">Sales Returns</field>
      <field name="res_model">sale.return</field>
      <field name="view_mode">list,form</field>
    </record>

    <menuitem
      id="sale_return_menu"
      name="Sales Returns"
      action="sale_return_action"
      parent="sale.sale_order_menu"
      sequence="20"/>
  </data>
</odoo>
